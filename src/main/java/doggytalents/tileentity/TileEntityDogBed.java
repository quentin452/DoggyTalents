package doggytalents.tileentity;

import java.util.List;

import net.minecraft.nbt.NBTTagCompound;
import net.minecraft.network.NetworkManager;
import net.minecraft.network.Packet;
import net.minecraft.network.play.server.S35PacketUpdateTileEntity;
import net.minecraft.tileentity.TileEntity;
import net.minecraft.util.AxisAlignedBB;

import doggytalents.entity.EntityDog;

/**
 * @author ProPercivalalb
 */
public class TileEntityDogBed extends TileEntity {

    private String casingId;
    private String beddingId;

    public TileEntityDogBed() {
        this.casingId = "";
        this.beddingId = "";
    }

    @Override
    public void readFromNBT(NBTTagCompound tag) {
        super.readFromNBT(tag);
        this.casingId = tag.getString("casingId");
        this.beddingId = tag.getString("beddingId");
    }

    @Override
    public void writeToNBT(NBTTagCompound tag) {
        super.writeToNBT(tag);
        tag.setString("casingId", this.casingId);
        tag.setString("beddingId", this.beddingId);
    }

    @Override
    public void updateEntity() {
        List dogs = this.worldObj.getEntitiesWithinAABB(
            EntityDog.class,
            AxisAlignedBB
                .getBoundingBox(
                    this.xCoord,
                    this.yCoord,
                    this.zCoord,
                    this.xCoord + 1.0D,
                    this.yCoord + 1.0D,
                    this.zCoord + 1.0D)
                .expand(3D, 2D, 3D));

        if (dogs != null && dogs.size() > 0) {
            for (int index = 0; index < dogs.size(); index++) {
                EntityDog dog = (EntityDog) dogs.get(index);

                if (dog.getMaxHealth() / 2 >= dog.getHealth()) {
                    // if(dog.bedHealTick <= 0) {
                    dog.heal(0.5F);
                    // dog.bedHealTick = 20 * 20;
                    // }
                    // dog.bedHealTick--;
                }
            }
        }

    }

    @Override
    public Packet getDescriptionPacket() {
        NBTTagCompound tagCompound = new NBTTagCompound();
        this.writeToNBT(tagCompound);
        return new S35PacketUpdateTileEntity(this.xCoord, this.yCoord, this.zCoord, 0, tagCompound);
    }

    @Override
    public void onDataPacket(NetworkManager net, S35PacketUpdateTileEntity pkt) {
        NBTTagCompound tag = pkt.func_148857_g();
        this.readFromNBT(tag);
    }

    public void setCasingId(String newId) {
        this.casingId = newId;
    }

    public void setBeddingId(String newId) {
        this.beddingId = newId;
    }

    public String getCasingId() {
        return this.casingId;
    }

    public String getBeddingId() {
        return this.beddingId;
    }
}
